<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>mapio.grid2d &mdash; MapIO 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="MapIO 0.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">MapIO 0.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for mapio.grid2d</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>

<span class="c">#stdlib imports</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c">#third party imports</span>
<span class="kn">from</span> <span class="nn">gridbase</span> <span class="kn">import</span> <span class="n">Grid</span>
<span class="kn">from</span> <span class="nn">dataset</span> <span class="kn">import</span> <span class="n">DataSetException</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">shapely</span>
<span class="kn">from</span> <span class="nn">affine</span> <span class="kn">import</span> <span class="n">Affine</span>
<span class="kn">from</span> <span class="nn">rasterio</span> <span class="kn">import</span> <span class="n">features</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">MultiPoint</span><span class="p">,</span><span class="n">Polygon</span><span class="p">,</span><span class="n">mapping</span>

<span class="k">def</span> <span class="nf">testGeoJSON</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="s">&#39;has_key&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;geometry&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;properties&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>

<div class="viewcode-block" id="Grid2D"><a class="viewcode-back" href="../../mapio.html#mapio.grid2d.Grid2D">[docs]</a><span class="k">class</span> <span class="nc">Grid2D</span><span class="p">(</span><span class="n">Grid</span><span class="p">):</span>
    <span class="n">reqfields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;xmin&#39;</span><span class="p">,</span><span class="s">&#39;xmax&#39;</span><span class="p">,</span><span class="s">&#39;ymin&#39;</span><span class="p">,</span><span class="s">&#39;ymax&#39;</span><span class="p">,</span><span class="s">&#39;xdim&#39;</span><span class="p">,</span><span class="s">&#39;ydim&#39;</span><span class="p">,</span><span class="s">&#39;ncols&#39;</span><span class="p">,</span><span class="s">&#39;nrows&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">geodict</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a Grid object.</span>
<span class="sd">        </span>
<span class="sd">        :param data: </span>
<span class="sd">            A 2D numpy array (can be None).</span>
<span class="sd">        :param geodict: </span>
<span class="sd">            A dictionary (or None) containing the following fields:</span>
<span class="sd">             - xmin Longitude minimum (decimal degrees) (Center of upper left cell)</span>
<span class="sd">             - xmax Longitude maximum (decimal degrees) (Center of upper right cell)</span>
<span class="sd">             - ymin Longitude minimum (decimal degrees) (Center of lower left cell)</span>
<span class="sd">             - ymax Longitude maximum (decimal degrees) (Center of lower right cell)</span>
<span class="sd">             - xdim Cell width (decimal degrees)</span>
<span class="sd">             - ydim Cell height (decimal degrees)</span>
<span class="sd">             - nrows Number of rows of input data (must match input data dimensions)</span>
<span class="sd">             - ncols Number of columns of input data (must match input data dimensions).</span>
<span class="sd">        :returns:</span>
<span class="sd">            A Grid object.  Internal representation of geodict input will have nrows/ncols fields added.</span>
<span class="sd">        :raises DataSetException:</span>
<span class="sd">           When data is not 2D or the number of rows and columns do not match the geodict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">geodict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">#complain if data is not 2D (squeeze 1d dimensions out)</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataSetException</span><span class="p">(</span><span class="s">&#39;Grid data must be 2D.  Input data has shape of </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span> <span class="o">=</span> <span class="n">dims</span>
            <span class="k">if</span> <span class="n">nrows</span> <span class="o">!=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">ncols</span> <span class="o">!=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">DataSetException</span><span class="p">(</span><span class="s">&#39;Input geodict does not match shape of input data.&#39;</span><span class="p">)</span>
            <span class="c">#complain if geodict does not have all required fields</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">geodict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reqfields</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">DataSetException</span><span class="p">(</span><span class="s">&#39;Missing some of required fields in geodict.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span> <span class="o">=</span> <span class="n">geodict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        String representation of a Grid2D object.</span>
<span class="sd">        :returns:</span>
<span class="sd">          String containing description of Grid2D object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">],</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">])</span>
        <span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xdim&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ydim&#39;</span><span class="p">])</span>
        <span class="n">zmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        <span class="n">zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        <span class="n">rstr</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;&lt;</span><span class="si">%s</span><span class="s"> Object:</span>
<span class="s">        nrows: </span><span class="si">%i</span><span class="s"></span>
<span class="s">        ncols: </span><span class="si">%i</span><span class="s"></span>
<span class="s">        xmin: </span><span class="si">%.4f</span><span class="s"></span>
<span class="s">        xmax: </span><span class="si">%.4f</span><span class="s"></span>
<span class="s">        ymin: </span><span class="si">%.4f</span><span class="s"></span>
<span class="s">        ymax: </span><span class="si">%.4f</span><span class="s"></span>
<span class="s">        xdim: </span><span class="si">%.4f</span><span class="s"></span>
<span class="s">        ydim: </span><span class="si">%.4f</span><span class="s"></span>
<span class="s">        zmin: </span><span class="si">%.6f</span><span class="s"></span>
<span class="s">        zmax: </span><span class="si">%.6f</span><span class="s">&gt;&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span><span class="p">,</span><span class="n">zmin</span><span class="p">,</span><span class="n">zmax</span><span class="p">)</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">rstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">newrstr</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">newrstr</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_createSampleData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Used for internal testing - create an NxN grid with lower left corner at 0.5,0.5, xdim/ydim = 1.0.</span>
<span class="sd">        :param M:</span>
<span class="sd">           Number of rows in output grid</span>
<span class="sd">        :param N:</span>
<span class="sd">           Number of columns in output grid</span>
<span class="sd">        :returns:</span>
<span class="sd">           GMTGrid object where data values are an NxN array of values from 0 to N-squared minus 1, and geodict</span>
<span class="sd">           lower left corner is at 0.5/0.5 and cell dimensions are 1.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">M</span><span class="o">*</span><span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="c">#arange gives int64 by default, not supported by netcdf3</span>
        <span class="n">xvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="o">+</span><span class="n">N</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">yvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="o">+</span><span class="n">M</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">geodict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;nrows&#39;</span><span class="p">:</span><span class="n">M</span><span class="p">,</span>
                   <span class="s">&#39;ncols&#39;</span><span class="p">:</span><span class="n">N</span><span class="p">,</span>
                   <span class="s">&#39;xmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span>
                   <span class="s">&#39;xmax&#39;</span><span class="p">:</span><span class="n">xvar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                   <span class="s">&#39;ymin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span>
                   <span class="s">&#39;ymax&#39;</span><span class="p">:</span><span class="n">yvar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                   <span class="s">&#39;xdim&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span>
                   <span class="s">&#39;ydim&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">}</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">geodict</span><span class="p">)</span>
    
    <span class="c">#This should be a @classmethod in subclasses</span>
    <span class="nd">@abc.abstractmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">resample</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">padValue</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;Load method not implemented in base class&#39;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Grid2D.copyFromGrid"><a class="viewcode-back" href="../../mapio.html#mapio.grid2d.Grid2D.copyFromGrid">[docs]</a>    <span class="k">def</span> <span class="nf">copyFromGrid</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="n">grid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy constructor - can be used to create an instance of any Grid2D subclass from another.</span>

<span class="sd">        :param grid:</span>
<span class="sd">          Any Grid2D instance.</span>
<span class="sd">        :returns:</span>
<span class="sd">          A copy of the data in that input Grid2D instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">Grid2D</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataSetException</span><span class="p">(</span><span class="s">&#39;Input to copyFromGrid must be an instance of a Grid2D object (inc. subclasses)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getData</span><span class="p">(),</span><span class="n">grid</span><span class="o">.</span><span class="n">getGeoDict</span><span class="p">())</span>

    <span class="c">#This should be a @classmethod in subclasses</span></div>
    <span class="nd">@abc.abstractmethod</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span> <span class="c">#would we ever want to save a subset of the data?</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;Save method not implemented in base class&#39;</span><span class="p">)</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_createSections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bounds</span><span class="p">,</span><span class="n">geodict</span><span class="p">,</span><span class="n">firstColumnDuplicated</span><span class="p">,</span><span class="n">isScanLine</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a grid that goes from -180 to 180 degrees, figure out the two pixel regions that up both sides of the subset.</span>
<span class="sd">        :param bounds:</span>
<span class="sd">           Tuple of (xmin,xmax,ymin,ymax)</span>
<span class="sd">        :param geodict:</span>
<span class="sd">           Geodict dictionary</span>
<span class="sd">        :param firstColumnDuplicated:</span>
<span class="sd">          Boolean indicating whether this is a global data set where the first and last columns are identical.</span>
<span class="sd">        :param isScanLine:</span>
<span class="sd">          Boolean indicating whether this array is in scan line order (pixel[0,0] is the geographic upper left).</span>
<span class="sd">        :returns:</span>
<span class="sd">          Two tuples of 4 elements each - (iulx,iuly,ilrx,ilry). The first tuple defines the pixel offsets for the left</span>
<span class="sd">          side of the subsetted region, and the second tuple defines the pixel offsets for the right side.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">bxmin</span><span class="p">,</span><span class="n">bxmax</span><span class="p">,</span><span class="n">bymin</span><span class="p">,</span><span class="n">bymax</span><span class="p">)</span> <span class="o">=</span> <span class="n">bounds</span>
        <span class="n">ulx</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">]</span>
        <span class="n">uly</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">]</span>
        <span class="n">xdim</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;xdim&#39;</span><span class="p">]</span>
        <span class="n">ydim</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ydim&#39;</span><span class="p">]</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">]</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">]</span>
        <span class="c">#section 1</span>
        <span class="n">iulx1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">bxmin</span> <span class="o">-</span> <span class="n">ulx</span><span class="p">)</span><span class="o">/</span><span class="n">xdim</span><span class="p">))</span>
        <span class="n">ilrx1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ncols</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isScanLine</span><span class="p">:</span>
            <span class="n">iuly1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">uly</span> <span class="o">-</span> <span class="n">bymax</span><span class="p">)</span><span class="o">/</span><span class="n">ydim</span><span class="p">))</span>
            <span class="n">ilry1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">uly</span> <span class="o">-</span> <span class="n">bymin</span><span class="p">)</span><span class="o">/</span><span class="n">ydim</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ilry1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">uly</span> <span class="o">-</span> <span class="n">bymin</span><span class="p">)</span><span class="o">/</span><span class="n">ydim</span><span class="p">))</span>
            <span class="n">iuly1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">uly</span> <span class="o">-</span> <span class="n">bymax</span><span class="p">)</span><span class="o">/</span><span class="n">ydim</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c">#section 2</span>
        <span class="n">iulx2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ilrx2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">bxmax</span> <span class="o">-</span> <span class="n">ulx</span><span class="p">)</span><span class="o">/</span><span class="n">xdim</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">iuly2</span> <span class="o">=</span> <span class="n">iuly1</span>
        <span class="n">ilry2</span> <span class="o">=</span> <span class="n">ilry1</span>

        <span class="k">if</span> <span class="n">firstColumnDuplicated</span><span class="p">:</span>
            <span class="n">ilrx1</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="n">region1</span> <span class="o">=</span> <span class="p">(</span><span class="n">iulx1</span><span class="p">,</span><span class="n">iuly1</span><span class="p">,</span><span class="n">ilrx1</span><span class="p">,</span><span class="n">ilry1</span><span class="p">)</span>
        <span class="n">region2</span> <span class="o">=</span> <span class="p">(</span><span class="n">iulx2</span><span class="p">,</span><span class="n">iuly2</span><span class="p">,</span><span class="n">ilrx2</span><span class="p">,</span><span class="n">ilry2</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">region1</span><span class="p">,</span><span class="n">region2</span><span class="p">)</span>
    
<div class="viewcode-block" id="Grid2D.getData"><a class="viewcode-back" href="../../mapio.html#mapio.grid2d.Grid2D.getData">[docs]</a>    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a reference to the data inside the Grid.</span>
<span class="sd">        </span>
<span class="sd">        :returns: </span>
<span class="sd">          A reference to a 2D numpy array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="c">#should we return a copy of the data?</span>
</div>
<div class="viewcode-block" id="Grid2D.getGeoDict"><a class="viewcode-back" href="../../mapio.html#mapio.grid2d.Grid2D.getGeoDict">[docs]</a>    <span class="k">def</span> <span class="nf">getGeoDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a reference to the geodict inside the Grid.</span>
<span class="sd">        :returns:</span>
<span class="sd">          A reference to a dictionary (see constructor).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span> <span class="c">#should we return a copy of the geodict?</span>
</div>
<div class="viewcode-block" id="Grid2D.getBounds"><a class="viewcode-back" href="../../mapio.html#mapio.grid2d.Grid2D.getBounds">[docs]</a>    <span class="k">def</span> <span class="nf">getBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the lon/lat range of the data.</span>
<span class="sd">        </span>
<span class="sd">        :returns:</span>
<span class="sd">           Tuple of (lonmin,lonmax,latmin,latmax)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Grid2D.trim"><a class="viewcode-back" href="../../mapio.html#mapio.grid2d.Grid2D.trim">[docs]</a>    <span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bounds</span><span class="p">,</span><span class="n">resample</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trim data to a smaller set of bounds, resampling if requested.  If not resampling,</span>
<span class="sd">        data will be trimmed to largest grid boundary possible.</span>
<span class="sd">        </span>
<span class="sd">        :param bounds:</span>
<span class="sd">           Tuple of (lonmin,lonmax,latmin,latmax)</span>
<span class="sd">        :param resample:</span>
<span class="sd">           Boolean indicating whether the data should be resampled to *exactly* match input bounds.</span>
<span class="sd">        :param method:</span>
<span class="sd">           If resampling, method used, one of (&#39;linear&#39;,&#39;nearest&#39;,&#39;cubic&#39;,&#39;quintic&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">bounds</span>
        <span class="n">gxmin</span><span class="p">,</span><span class="n">gxmax</span><span class="p">,</span><span class="n">gymin</span><span class="p">,</span><span class="n">gymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBounds</span><span class="p">()</span>
        <span class="c">#if any of the input bounds are outside the bounds of the grid, cut off those edges</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">gxmin</span><span class="p">)</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xmax</span><span class="p">,</span><span class="n">gxmax</span><span class="p">)</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">gymin</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymax</span><span class="p">,</span><span class="n">gymax</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resample</span><span class="p">:</span>
            <span class="n">uly</span><span class="p">,</span><span class="n">ulx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRowCol</span><span class="p">(</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">returnFloat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">lry</span><span class="p">,</span><span class="n">lrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRowCol</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">returnFloat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">uly</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">uly</span><span class="p">))</span> <span class="c">#these are in pixel space!</span>
            <span class="n">ulx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ulx</span><span class="p">))</span>
            <span class="n">lrx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">lrx</span><span class="p">))</span>
            <span class="n">lry</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">lry</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">uly</span><span class="p">:</span><span class="n">lry</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ulx</span><span class="p">:</span><span class="n">lrx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">newymax</span><span class="p">,</span><span class="n">newxmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatLon</span><span class="p">(</span><span class="n">uly</span><span class="p">,</span><span class="n">ulx</span><span class="p">)</span>
            <span class="n">newymin</span><span class="p">,</span><span class="n">newxmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatLon</span><span class="p">(</span><span class="n">lry</span><span class="p">,</span><span class="n">lrx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newxmin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newxmax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newymin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newymax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xdim&#39;</span><span class="p">]</span>
            <span class="n">ydim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ydim&#39;</span><span class="p">]</span>
            <span class="n">indict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;xmin&#39;</span><span class="p">:</span><span class="n">xmin</span><span class="p">,</span><span class="s">&#39;xmax&#39;</span><span class="p">:</span><span class="n">xmax</span><span class="p">,</span><span class="s">&#39;ymin&#39;</span><span class="p">:</span><span class="n">ymin</span><span class="p">,</span><span class="s">&#39;ymax&#39;</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="s">&#39;xdim&#39;</span><span class="p">:</span><span class="n">xdim</span><span class="p">,</span><span class="s">&#39;ydim&#39;</span><span class="p">:</span><span class="n">ydim</span><span class="p">}</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="o">+</span><span class="p">(</span><span class="n">xdim</span><span class="o">*</span><span class="mf">0.1</span><span class="p">),</span><span class="n">xdim</span><span class="p">))</span>
            <span class="n">nrows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">+</span><span class="p">(</span><span class="n">ydim</span><span class="o">*</span><span class="mf">0.1</span><span class="p">),</span><span class="n">ydim</span><span class="p">))</span>
            <span class="n">indict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nrows</span>
            <span class="n">indict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ncols</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolateToGrid</span><span class="p">(</span><span class="n">indict</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Grid2D.getValue"><a class="viewcode-back" href="../../mapio.html#mapio.grid2d.Grid2D.getValue">[docs]</a>    <span class="k">def</span> <span class="nf">getValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span> <span class="c">#return nearest neighbor value</span>
        <span class="sd">&quot;&quot;&quot;Return numpy array at given latitude and longitude (using nearest neighbor).</span>
<span class="sd">        </span>
<span class="sd">        :param lat: </span>
<span class="sd">           Latitude (in decimal degrees) of desired data value.</span>
<span class="sd">        :param lon: </span>
<span class="sd">           Longitude (in decimal degrees) of desired data value.</span>
<span class="sd">        :param method:</span>
<span class="sd">           Interpolation method, one of (&#39;nearest&#39;,&#39;linear&#39;,&#39;cubic&#39;,&#39;quintic&#39;)</span>
<span class="sd">        :param default:</span>
<span class="sd">           Default value to return when lat/lon is outside of grid bounds.</span>
<span class="sd">        :return: </span>
<span class="sd">           Value at input latitude,longitude position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;nearest&#39;</span><span class="p">:</span>
            <span class="n">row</span><span class="p">,</span><span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRowCol</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row</span><span class="p">,</span><span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRowCol</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">returnFloat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">row</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="n">row</span> <span class="o">&gt;</span> <span class="n">nrows</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="n">col</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="n">col</span> <span class="o">&gt;</span> <span class="n">ncols</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;One of more of your lat/lon values is outside Grid boundaries: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getRange</span><span class="p">()))</span>
                <span class="k">raise</span> <span class="n">DataSetException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">default</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;nearest&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;getValue method &quot;</span><span class="si">%s</span><span class="s">&quot; not implemented yet&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Grid2D.getLatLon"><a class="viewcode-back" href="../../mapio.html#mapio.grid2d.Grid2D.getLatLon">[docs]</a>    <span class="k">def</span> <span class="nf">getLatLon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return geographic coordinates (lat/lon decimal degrees) for given data row and column.</span>
<span class="sd">        </span>
<span class="sd">        :param row: </span>
<span class="sd">           Row dimension index into internal data array.</span>
<span class="sd">        :param col: </span>
<span class="sd">           Column dimension index into internal data array.</span>
<span class="sd">        :returns: </span>
<span class="sd">           Tuple of latitude and longitude.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ulx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">]</span>
        <span class="n">uly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">]</span>
        <span class="n">xdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xdim&#39;</span><span class="p">]</span>
        <span class="n">ydim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ydim&#39;</span><span class="p">]</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">ulx</span> <span class="o">+</span> <span class="n">col</span><span class="o">*</span><span class="n">xdim</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">uly</span> <span class="o">-</span> <span class="n">row</span><span class="o">*</span><span class="n">ydim</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Grid2D.getRowCol"><a class="viewcode-back" href="../../mapio.html#mapio.grid2d.Grid2D.getRowCol">[docs]</a>    <span class="k">def</span> <span class="nf">getRowCol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">returnFloat</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return data row and column from given geographic coordinates (lat/lon decimal degrees).</span>
<span class="sd">        </span>
<span class="sd">        :param lat: </span>
<span class="sd">           Input latitude.</span>
<span class="sd">        :param lon: </span>
<span class="sd">           Input longitude.</span>
<span class="sd">        :param returnFloat: </span>
<span class="sd">           Boolean indicating whether floating point row/col coordinates should be returned.</span>
<span class="sd">        :returns: </span>
<span class="sd">           Tuple of row and column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ulx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">]</span>
        <span class="n">uly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">]</span>
        <span class="n">xdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xdim&#39;</span><span class="p">]</span>
        <span class="n">ydim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ydim&#39;</span><span class="p">]</span>
        <span class="c">#check to see if we&#39;re in a scenario where the grid crosses the meridian</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ulx</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="n">ulx</span><span class="p">:</span>
            <span class="n">lon</span> <span class="o">+=</span> <span class="mi">360</span>
        <span class="n">col</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon</span><span class="o">-</span><span class="n">ulx</span><span class="p">)</span><span class="o">/</span><span class="n">xdim</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">(</span><span class="n">uly</span><span class="o">-</span><span class="n">lat</span><span class="p">)</span><span class="o">/</span><span class="n">ydim</span>
        <span class="k">if</span> <span class="n">returnFloat</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
</div>
    <span class="k">def</span> <span class="nf">_getInterpCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">geodict</span><span class="p">):</span>
        <span class="c">#translate geographic coordinates to 2 1-D arrays of X and Y pixel coordinates</span>
        <span class="c">#remember that pixel coordinates are (0,0) at the top left and increase going down and to the right</span>
        <span class="c">#geographic coordinates are (xmin,ymin) at the bottom left and increase going up and to the right</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">nrows1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">]</span>
        <span class="n">ncols1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">]</span>
        <span class="n">xmin1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">]</span>
        <span class="n">xmax1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">]</span>
        <span class="n">ymin1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">]</span>
        <span class="n">ymax1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">]</span>
        <span class="n">xdim1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xdim&#39;</span><span class="p">]</span>
        <span class="n">ydim1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ydim&#39;</span><span class="p">]</span>
        
        <span class="c">#extract the geographic information about the grid we&#39;re sampling to</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">]</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">]</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">]</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">]</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">]</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">]</span>
        <span class="n">xdim</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;xdim&#39;</span><span class="p">]</span>
        <span class="n">ydim</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ydim&#39;</span><span class="p">]</span>

        <span class="c">#make sure that the grid we&#39;re resampling TO is completely contained by our current grid</span>
        <span class="k">if</span> <span class="n">xmin1</span> <span class="o">&gt;</span> <span class="n">xmin</span> <span class="ow">or</span> <span class="n">xmax1</span> <span class="o">&lt;</span> <span class="n">xmax</span> <span class="ow">or</span> <span class="n">ymin1</span> <span class="o">&gt;</span> <span class="n">ymin</span> <span class="ow">or</span> <span class="n">ymax1</span> <span class="o">&lt;</span> <span class="n">ymax</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataSetException</span><span class="p">(</span><span class="s">&#39;Grid you are resampling TO is not completely contained by base grid.&#39;</span><span class="p">)</span>
        
        <span class="n">gxi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="n">ncols</span><span class="p">)</span>
        <span class="n">gyi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="n">nrows</span><span class="p">)</span>
        
        <span class="c">#we need to handle the meridian crossing here...</span>
        <span class="k">if</span> <span class="n">xmin</span> <span class="o">&gt;</span> <span class="n">xmax</span><span class="p">:</span>
            <span class="n">xmax</span> <span class="o">+=</span> <span class="mi">360</span>
            <span class="n">xmin1</span> <span class="o">+=</span> <span class="mi">360</span>

        <span class="n">xi</span> <span class="o">=</span> <span class="p">(</span><span class="n">gxi</span> <span class="o">-</span> <span class="n">xmin1</span><span class="p">)</span><span class="o">/</span><span class="n">xdim1</span>
        <span class="c">#yi = (gyi - ymin1)/ydim1</span>
        <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(((</span><span class="n">ymax1</span> <span class="o">-</span> <span class="n">gyi</span><span class="p">)</span><span class="o">/</span><span class="n">ydim1</span><span class="p">)))</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
    
<div class="viewcode-block" id="Grid2D.interpolateToGrid"><a class="viewcode-back" href="../../mapio.html#mapio.grid2d.Grid2D.interpolateToGrid">[docs]</a>    <span class="k">def</span> <span class="nf">interpolateToGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">geodict</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a geodict specifying another grid extent and resolution, resample current grid to match.</span>
<span class="sd">        </span>
<span class="sd">        :param geodict: </span>
<span class="sd">            geodict dictionary from another grid whose extents are inside the extent of this grid.</span>
<span class="sd">        :keyword method: </span>
<span class="sd">            Optional interpolation method - [&#39;linear&#39;, &#39;cubic&#39;,&#39;nearest&#39;]</span>
<span class="sd">        :raises DataSetException: </span>
<span class="sd">           If the Grid object upon which this function is being called is not completely contained by the grid to which this Grid is being resampled.</span>
<span class="sd">        :raises DataSetException: </span>
<span class="sd">           If the method is not one of [&#39;nearest&#39;,&#39;linear&#39;,&#39;cubic&#39;]</span>
<span class="sd">           If the resulting interpolated grid shape does not match input geodict.</span>
<span class="sd">        This function modifies the internal griddata and geodict object variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;linear&#39;</span><span class="p">,</span> <span class="s">&#39;cubic&#39;</span><span class="p">,</span><span class="s">&#39;nearest&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">DataSetException</span><span class="p">(</span><span class="s">&#39;Resampling method must be one of &quot;linear&quot;, &quot;cubic&quot;,&quot;nearest&quot;&#39;</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">geodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">],</span><span class="n">geodict</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">],</span><span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">],</span><span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">])</span>
        <span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span> <span class="o">=</span> <span class="p">(</span><span class="n">geodict</span><span class="p">[</span><span class="s">&#39;xdim&#39;</span><span class="p">],</span><span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ydim&#39;</span><span class="p">])</span>
        <span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span> <span class="o">=</span> <span class="p">(</span><span class="n">geodict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">],</span><span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">])</span>
        <span class="n">geodict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Grid2D</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fixGeoDict</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span><span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span><span class="p">,</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span><span class="n">preserve</span><span class="o">=</span><span class="s">&#39;dims&#39;</span><span class="p">)</span>
        <span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getInterpCoords</span><span class="p">(</span><span class="n">geodict</span><span class="p">)</span>

        <span class="c">#now using scipy interpolate functions</span>
        <span class="n">baserows</span><span class="p">,</span><span class="n">basecols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">]</span>
        <span class="n">basex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">basecols</span><span class="p">)</span> <span class="c">#base grid PIXEL coordinates</span>
        <span class="n">basey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">baserows</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;linear&#39;</span><span class="p">,</span><span class="s">&#39;cubic&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="c">#at the time of this writing, interp2d does not support NaN values at all.</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">basex</span><span class="p">,</span><span class="n">basey</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">#is Nan values are present, use griddata (slower by ~2 orders of magnitude but supports NaN).</span>
                <span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
                <span class="n">newrows</span><span class="p">,</span><span class="n">newcols</span> <span class="o">=</span> <span class="n">xi</span><span class="o">.</span><span class="n">shape</span>
                <span class="n">xi</span> <span class="o">=</span> <span class="n">xi</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">yi</span> <span class="o">=</span> <span class="n">yi</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
                <span class="n">xnew</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xi</span>
                <span class="n">xnew</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">yi</span>
                <span class="n">basex</span><span class="p">,</span><span class="n">basey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">basex</span><span class="p">,</span><span class="n">basey</span><span class="p">)</span>
                <span class="n">basex</span> <span class="o">=</span> <span class="n">basex</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">basey</span> <span class="o">=</span> <span class="n">basey</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">xold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">basex</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
                <span class="n">xold</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">basex</span>
                <span class="n">xold</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">basey</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span><span class="n">xold</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">xnew</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">newrows</span><span class="p">,</span><span class="n">newcols</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">basex</span><span class="p">,</span><span class="n">basey</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">NearestNDInterpolator</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
            <span class="n">newrows</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">]</span>
            <span class="n">newcols</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">]</span>
            <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">xi</span><span class="p">,(</span><span class="n">newrows</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">yi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">newrows</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="n">newcols</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">yi</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                                                  
            
        <span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">],</span><span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">]</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">nrows_new</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ncols_new</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">nrows_new</span> <span class="o">!=</span> <span class="n">nrows</span> <span class="ow">or</span> <span class="n">ncols_new</span> <span class="o">!=</span> <span class="n">ncols</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Interpolation failed!  Results (</span><span class="si">%i</span><span class="s">,</span><span class="si">%i</span><span class="s">) don&#39;t match (</span><span class="si">%i</span><span class="s">,</span><span class="si">%i</span><span class="s">)!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nrows_new</span><span class="p">,</span><span class="n">ncols_new</span><span class="p">,</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">DataSetException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c">#now the extents and resolution of the two grids should be identical...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;xdim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;xdim&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geodict</span><span class="p">[</span><span class="s">&#39;ydim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ydim&#39;</span><span class="p">]</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Grid2D.rasterizeFromGeometry"><a class="viewcode-back" href="../../mapio.html#mapio.grid2d.Grid2D.rasterizeFromGeometry">[docs]</a>    <span class="k">def</span> <span class="nf">rasterizeFromGeometry</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="n">shapes</span><span class="p">,</span><span class="n">samplegeodict</span><span class="p">,</span><span class="n">burnValue</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">fillValue</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">allTouched</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">attribute</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a Grid2D object from vector shapes, where the presence of a shape (point, line, polygon) inside a cell turns that cell &quot;on&quot;.</span>
<span class="sd">        :param shapes:</span>
<span class="sd">          One of:</span>
<span class="sd">            - One shapely geometry object (Point, Polygon, etc.) or a sequence of such objects</span>
<span class="sd">            - One GeoJSON like object or sequence of such objects. (http://geojson.org/)</span>
<span class="sd">            - A tuple of (geometry,value) or sequence of (geometry,value).</span>
<span class="sd">        :param samplegeodict:</span>
<span class="sd">          GeoDict with at least xmin,xmax,ymin,ymax,xdim,ydim values set.</span>
<span class="sd">        :param burnValue:</span>
<span class="sd">          Optional value which will be used to set the value of the pixels if there is no value in the geometry field.</span>
<span class="sd">        :param fillValue:</span>
<span class="sd">          Optional value which will be used to fill the cells not touched by any geometry.</span>
<span class="sd">        :param allTouched:</span>
<span class="sd">          Optional boolean which indicates whether the geometry must touch the center of the cell or merely be inside the cell in order to set the value.</span>
<span class="sd">        :raises DataSetException:</span>
<span class="sd">          When geometry input is not a subclass of shapely.geometry.base.BaseGeometry.</span>
<span class="sd">        :returns:</span>
<span class="sd">          Grid2D object.</span>
<span class="sd">        This method is a thin wrapper around rasterio-&gt;features-&gt;rasterize(), documented here:</span>
<span class="sd">        https://github.com/mapbox/rasterio/blob/master/docs/features.rst</span>

<span class="sd">        which is itself a Python wrapper around the functionality found in gdal_rasterize, documented here:</span>
<span class="sd">        http://www.gdal.org/gdal_rasterize.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#check the type of shapes</span>
        <span class="c">#features.rasterize() documentation says this:</span>
        <span class="c">#iterable of (geometry, value) pairs or iterable over</span>
        <span class="c">#geometries. `geometry` can either be an object that implements</span>
        <span class="c">#the geo interface or GeoJSON-like object.</span>

        <span class="c">#figure out whether this is a single shape or a sequence of shapes</span>
        <span class="n">isGeoJSON</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">isGeometry</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">isSequence</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">isTuple</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">tuple</span><span class="p">):</span>
                <span class="n">isTuple</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">isOk</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">isShape</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span><span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">BaseGeometry</span><span class="p">):</span>
            <span class="n">isOk</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">isShape</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">shapes</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">BaseGeometry</span><span class="p">):</span>
            <span class="n">isOk</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">isShape</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span><span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">shapes</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;geometry&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">shapes</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;properties&#39;</span><span class="p">):</span>
            <span class="n">isOk</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">shapes</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;geometry&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;properties&#39;</span><span class="p">):</span>
            <span class="n">isOk</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isOk</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataSetException</span><span class="p">(</span><span class="s">&#39;shapes must be a single shapely object or sequence of them, or single Geo-JSON like-object&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isShape</span><span class="p">:</span>
            <span class="n">shapes2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
                <span class="n">geometry</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="s">&#39;geometry&#39;</span><span class="p">]</span>
                <span class="n">props</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="s">&#39;properties&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">props</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">attribute</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">DataSetException</span><span class="p">(</span><span class="s">&#39;Input shapes do not have attribute &quot;</span><span class="si">%s</span><span class="s">&quot;.&#39;</span> <span class="o">%</span> <span class="n">attribute</span><span class="p">)</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="nb">long</span><span class="p">)):</span>
                        <span class="k">raise</span> <span class="n">DataSetException</span><span class="p">(</span><span class="s">&#39;value from input shapes object is not a number&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">burnValue</span>
                <span class="n">shapes2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">geometry</span><span class="p">,</span><span class="n">value</span><span class="p">))</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="n">shapes2</span>
        
                                   
        <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="p">(</span><span class="n">samplegeodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">],</span><span class="n">samplegeodict</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">],</span><span class="n">samplegeodict</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">],</span><span class="n">samplegeodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">])</span>
        <span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span> <span class="o">=</span> <span class="p">(</span><span class="n">samplegeodict</span><span class="p">[</span><span class="s">&#39;xdim&#39;</span><span class="p">],</span><span class="n">samplegeodict</span><span class="p">[</span><span class="s">&#39;ydim&#39;</span><span class="p">])</span>

        <span class="n">xvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="o">+</span><span class="p">(</span><span class="n">xdim</span><span class="o">*</span><span class="mf">0.1</span><span class="p">),</span><span class="n">xdim</span><span class="p">)</span>
        <span class="n">yvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">+</span><span class="p">(</span><span class="n">ydim</span><span class="o">*</span><span class="mf">0.1</span><span class="p">),</span><span class="n">ydim</span><span class="p">)</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xvar</span><span class="p">)</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yvar</span><span class="p">)</span>
        
        <span class="c">#the rasterize function assumes a pixel registered data set, where we are grid registered.  In order to make this work</span>
        <span class="c">#we need to adjust the edges of our grid out by half a cell width in each direction.  </span>
        <span class="n">txmin</span> <span class="o">=</span> <span class="n">xmin</span> <span class="o">-</span> <span class="n">xdim</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">tymax</span> <span class="o">=</span> <span class="n">ymax</span> <span class="o">+</span> <span class="n">ydim</span><span class="o">/</span><span class="mf">2.0</span>
        
        <span class="n">outshape</span> <span class="o">=</span> <span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">)</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">Affine</span><span class="o">.</span><span class="n">from_gdal</span><span class="p">(</span><span class="n">txmin</span><span class="p">,</span><span class="n">xdim</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">tymax</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="n">ydim</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span><span class="n">out_shape</span><span class="o">=</span><span class="n">outshape</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">fillValue</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span><span class="n">all_touched</span><span class="o">=</span><span class="n">allTouched</span><span class="p">,</span><span class="n">default_value</span><span class="o">=</span><span class="n">burnValue</span><span class="p">)</span>
        <span class="n">geodict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;xmin&#39;</span><span class="p">:</span><span class="n">xmin</span><span class="p">,</span><span class="s">&#39;xmax&#39;</span><span class="p">:</span><span class="n">xmax</span><span class="p">,</span><span class="s">&#39;ymin&#39;</span><span class="p">:</span><span class="n">ymin</span><span class="p">,</span><span class="s">&#39;ymax&#39;</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="s">&#39;xdim&#39;</span><span class="p">:</span><span class="n">xdim</span><span class="p">,</span><span class="s">&#39;ydim&#39;</span><span class="p">:</span><span class="n">ydim</span><span class="p">,</span><span class="s">&#39;nrows&#39;</span><span class="p">:</span><span class="n">nrows</span><span class="p">,</span><span class="s">&#39;ncols&#39;</span><span class="p">:</span><span class="n">ncols</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">geodict</span><span class="p">)</span>
        </div></div>
<span class="k">def</span> <span class="nf">_test_basics</span><span class="p">():</span>
    <span class="n">geodict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;xmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s">&#39;xmax&#39;</span><span class="p">:</span><span class="mf">3.5</span><span class="p">,</span><span class="s">&#39;ymin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s">&#39;ymax&#39;</span><span class="p">:</span><span class="mf">3.5</span><span class="p">,</span><span class="s">&#39;xdim&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;ydim&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;nrows&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="s">&#39;ncols&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">Grid2D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">geodict</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;Testing basic Grid2D functionality (retrieving data, lat/lon to pixel coordinates, etc...&#39;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getData</span><span class="p">(),</span><span class="n">data</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">grid</span><span class="o">.</span><span class="n">getGeoDict</span><span class="p">()</span> <span class="o">==</span> <span class="n">geodict</span>

    <span class="k">assert</span> <span class="n">grid</span><span class="o">.</span><span class="n">getBounds</span><span class="p">()</span> <span class="o">==</span> <span class="p">(</span><span class="n">geodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">],</span><span class="n">geodict</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">],</span><span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">],</span><span class="n">geodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">])</span>
    
    <span class="n">lat</span><span class="p">,</span><span class="n">lon</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getLatLon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">lat</span> <span class="o">==</span> <span class="mf">3.5</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">==</span> <span class="mf">0.5</span>
        
    <span class="n">row</span><span class="p">,</span><span class="n">col</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getRowCol</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span>
    
    <span class="n">value</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span>
    
    <span class="n">frow</span><span class="p">,</span><span class="n">fcol</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getRowCol</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="n">returnFloat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">frow</span> <span class="o">==</span> <span class="mf">2.5</span> <span class="ow">and</span> <span class="n">fcol</span> <span class="o">==</span> <span class="mf">2.5</span>
    
    <span class="n">irow</span><span class="p">,</span><span class="n">icol</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getRowCol</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="n">returnFloat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">irow</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">icol</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">print</span> <span class="s">&#39;Passed basic Grid2D functionality (retrieving data, lat/lon to pixel coordinates, etc...&#39;</span>
    
<span class="k">def</span> <span class="nf">_test_resample</span><span class="p">():</span>
    <span class="n">geodict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;xmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s">&#39;xmax&#39;</span><span class="p">:</span><span class="mf">4.5</span><span class="p">,</span><span class="s">&#39;ymin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s">&#39;ymax&#39;</span><span class="p">:</span><span class="mf">4.5</span><span class="p">,</span><span class="s">&#39;xdim&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;ydim&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;nrows&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="s">&#39;ncols&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&#39;Testing data trimming without resampling...&#39;</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">Grid2D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">geodict</span><span class="p">)</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">)</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span><span class="n">resample</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">],[</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">]])</span>
    <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getData</span><span class="p">(),</span><span class="n">output</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;Passed data trimming without resampling...&#39;</span>

    <span class="k">print</span> <span class="s">&#39;Testing data trimming with resampling...&#39;</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">Grid2D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">geodict</span><span class="p">)</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span><span class="n">resample</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">9.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">],[</span><span class="mf">14.0</span><span class="p">,</span><span class="mf">15.0</span><span class="p">]])</span>
    <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getData</span><span class="p">(),</span><span class="n">output</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;Passed data trimming with resampling...&#39;</span>

<span class="k">def</span> <span class="nf">_test_interpolate</span><span class="p">():</span>
    <span class="n">geodict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;xmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s">&#39;xmax&#39;</span><span class="p">:</span><span class="mf">6.5</span><span class="p">,</span><span class="s">&#39;ymin&#39;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span><span class="s">&#39;ymax&#39;</span><span class="p">:</span><span class="mf">6.5</span><span class="p">,</span><span class="s">&#39;xdim&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;ydim&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;nrows&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="s">&#39;ncols&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">56</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>

    <span class="c"># grid = Grid2D(data,geodict)</span>
    <span class="c"># sampledict = Grid2D.fixGeoDict((3.0,4.0,3.0,4.0),1.0,1.0,-1,-1)</span>
    <span class="c"># grid.interpolateToGrid(sampledict,method=&#39;linear&#39;)</span>

    <span class="c"># output = np.array([[34.,35.],[41.,42.]])</span>
    <span class="c"># np.testing.assert_almost_equal(grid._data,output)</span>
    
    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span><span class="s">&#39;linear&#39;</span><span class="p">,</span><span class="s">&#39;cubic&#39;</span><span class="p">]:</span>
        <span class="k">print</span> <span class="s">&#39;Testing interpolate with method &quot;</span><span class="si">%s</span><span class="s">&quot;...&#39;</span> <span class="o">%</span> <span class="n">method</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">Grid2D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">geodict</span><span class="p">)</span>
        <span class="c">#sampledict = {&#39;xmin&#39;:2.0,&#39;xmax&#39;:3.0,&#39;ymin&#39;:2.0,&#39;ymax&#39;:3.0,&#39;xdim&#39;:1.0,&#39;ydim&#39;:1.0}</span>
        <span class="n">sampledict</span> <span class="o">=</span> <span class="n">Grid2D</span><span class="o">.</span><span class="n">fixGeoDict</span><span class="p">((</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">),</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">interpolateToGrid</span><span class="p">(</span><span class="n">sampledict</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;nearest&#39;</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">30.0</span><span class="p">,</span><span class="mf">31.0</span><span class="p">],[</span><span class="mf">37.0</span><span class="p">,</span><span class="mf">38.0</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">34.</span><span class="p">,</span><span class="mf">35.</span><span class="p">],[</span><span class="mf">41.</span><span class="p">,</span><span class="mf">42.</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;cubic&#39;</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">34.</span><span class="p">,</span><span class="mf">35.</span><span class="p">],[</span><span class="mf">41.</span><span class="p">,</span><span class="mf">42.</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getData</span><span class="p">(),</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;Passed interpolate with method &quot;</span><span class="si">%s</span><span class="s">&quot;.&#39;</span> <span class="o">%</span> <span class="n">method</span>

<span class="k">def</span> <span class="nf">_test_rasterize</span><span class="p">():</span>
    <span class="n">samplegeodict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;xmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s">&#39;xmax&#39;</span><span class="p">:</span><span class="mf">3.5</span><span class="p">,</span><span class="s">&#39;ymin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s">&#39;ymax&#39;</span><span class="p">:</span><span class="mf">3.5</span><span class="p">,</span><span class="s">&#39;xdim&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;ydim&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">}</span>
    <span class="k">print</span> <span class="s">&#39;Testing rasterizeFromGeometry() trying to get binary output...&#39;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">MultiPoint</span><span class="p">([(</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">3.5</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mf">1.75</span><span class="p">,</span><span class="mf">3.75</span><span class="p">,</span><span class="mf">6.0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mf">3.25</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">17.0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mf">3.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">86.0</span><span class="p">)])</span>
    
    <span class="n">grid</span> <span class="o">=</span> <span class="n">Grid2D</span><span class="o">.</span><span class="n">rasterizeFromGeometry</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">samplegeodict</span><span class="p">,</span><span class="n">burnValue</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">fillValue</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]])</span>
    <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getData</span><span class="p">(),</span><span class="n">output</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;Passed rasterizeFromGeometry() trying to get binary output.&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Testing rasterizeFromGeometry() burning in values from a polygon sequence...&#39;</span>
        <span class="c">#Define two simple polygons and assign them to shapes</span>
        <span class="n">poly1</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">3.75</span><span class="p">),(</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">3.25</span><span class="p">),(</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">2.25</span><span class="p">)]</span>
        <span class="n">poly2</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">2.25</span><span class="p">,</span><span class="mf">3.75</span><span class="p">),(</span><span class="mf">3.25</span><span class="p">,</span><span class="mf">3.75</span><span class="p">),(</span><span class="mf">3.75</span><span class="p">,</span><span class="mf">2.75</span><span class="p">),(</span><span class="mf">3.75</span><span class="p">,</span><span class="mf">1.50</span><span class="p">),(</span><span class="mf">3.25</span><span class="p">,</span><span class="mf">0.75</span><span class="p">),(</span><span class="mf">2.25</span><span class="p">,</span><span class="mf">2.25</span><span class="p">)]</span>
        <span class="n">shape1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;properties&#39;</span><span class="p">:{</span><span class="s">&#39;value&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">},</span><span class="s">&#39;geometry&#39;</span><span class="p">:</span><span class="n">mapping</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">poly1</span><span class="p">))}</span>
        <span class="n">shape2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;properties&#39;</span><span class="p">:{</span><span class="s">&#39;value&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">},</span><span class="s">&#39;geometry&#39;</span><span class="p">:</span><span class="n">mapping</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">poly2</span><span class="p">))}</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">shape1</span><span class="p">,</span><span class="n">shape2</span><span class="p">]</span>
        
        <span class="n">grid</span> <span class="o">=</span> <span class="n">Grid2D</span><span class="o">.</span><span class="n">rasterizeFromGeometry</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span><span class="n">samplegeodict</span><span class="p">,</span><span class="n">fillValue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">attribute</span><span class="o">=</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span>
                           <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span>
                           <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span>
                           <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">]])</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getData</span><span class="p">(),</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;Testing rasterizeFromGeometry() burning in values from a polygon shapefile...&#39;</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">shpfiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&#39;test.*&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">shpfile</span> <span class="ow">in</span> <span class="n">shpfiles</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">shpfile</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_test_fixgeodict</span><span class="p">():</span>
    <span class="n">subbounds</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">118.7834</span><span class="p">,</span><span class="o">-</span><span class="mf">117.0123</span><span class="p">,</span><span class="mf">32.8754</span><span class="p">,</span><span class="mf">33.7896</span><span class="p">)</span>
    <span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.02</span><span class="p">,</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="n">nrows</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">subgeodict</span> <span class="o">=</span> <span class="n">Grid2D</span><span class="o">.</span><span class="n">fixGeoDict</span><span class="p">(</span><span class="n">subbounds</span><span class="p">,</span><span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span><span class="p">,</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span><span class="n">preserve</span><span class="o">=</span><span class="s">&#39;dims&#39;</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;After initial fix, nrows = </span><span class="si">%i</span><span class="s">, ncols = </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subgeodict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">],</span><span class="n">subgeodict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">])</span>

    <span class="n">newbounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">subgeodict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">],</span><span class="n">subgeodict</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">],</span><span class="n">subgeodict</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">],</span><span class="n">subgeodict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">])</span>
    <span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span> <span class="o">=</span> <span class="p">(</span><span class="n">subgeodict</span><span class="p">[</span><span class="s">&#39;xdim&#39;</span><span class="p">],</span><span class="n">subgeodict</span><span class="p">[</span><span class="s">&#39;ydim&#39;</span><span class="p">])</span>
    <span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">newdict</span> <span class="o">=</span> <span class="n">Grid2D</span><span class="o">.</span><span class="n">fixGeoDict</span><span class="p">(</span><span class="n">newbounds</span><span class="p">,</span><span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span><span class="p">,</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span><span class="n">preserve</span><span class="o">=</span><span class="s">&#39;dims&#39;</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;After second fix, nrows = </span><span class="si">%i</span><span class="s">, ncols = </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">],</span><span class="n">newdict</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">])</span>

    <span class="n">newbounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">],</span><span class="n">newdict</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">],</span><span class="n">newdict</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">],</span><span class="n">newdict</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">])</span>
    <span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span> <span class="o">=</span> <span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="s">&#39;xdim&#39;</span><span class="p">],</span><span class="n">newdict</span><span class="p">[</span><span class="s">&#39;ydim&#39;</span><span class="p">])</span>
    <span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">newdict2</span> <span class="o">=</span> <span class="n">Grid2D</span><span class="o">.</span><span class="n">fixGeoDict</span><span class="p">(</span><span class="n">newbounds</span><span class="p">,</span><span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span><span class="p">,</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span><span class="n">preserve</span><span class="o">=</span><span class="s">&#39;dims&#39;</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;After third fix, nrows = </span><span class="si">%i</span><span class="s">, ncols = </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newdict2</span><span class="p">[</span><span class="s">&#39;nrows&#39;</span><span class="p">],</span><span class="n">newdict2</span><span class="p">[</span><span class="s">&#39;ncols&#39;</span><span class="p">])</span>
    
    <span class="k">assert</span> <span class="n">subgeodict</span> <span class="o">==</span> <span class="n">newdict</span>

<span class="k">def</span> <span class="nf">_test_copy</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">geodict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;xmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s">&#39;xmax&#39;</span><span class="p">:</span><span class="mf">3.5</span><span class="p">,</span><span class="s">&#39;ymin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s">&#39;ymax&#39;</span><span class="p">:</span><span class="mf">3.5</span><span class="p">,</span><span class="s">&#39;xdim&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;ydim&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;nrows&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="s">&#39;ncols&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span>
    <span class="n">grid1</span> <span class="o">=</span> <span class="n">Grid2D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">geodict</span><span class="p">)</span>
    <span class="n">grid2</span> <span class="o">=</span> <span class="n">grid1</span><span class="o">.</span><span class="n">copyFromGrid</span><span class="p">(</span><span class="n">grid1</span><span class="p">)</span>
    <span class="n">grid1</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">print</span> <span class="n">grid2</span><span class="o">.</span><span class="n">_data</span>
    <span class="k">print</span> <span class="n">grid2</span><span class="o">.</span><span class="n">_geodict</span>    
    
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">_test_fixgeodict</span><span class="p">()</span>
    <span class="n">_test_interpolate</span><span class="p">()</span>
    <span class="n">_test_rasterize</span><span class="p">()</span>
    <span class="n">_test_basics</span><span class="p">()</span>
    <span class="n">_test_resample</span><span class="p">()</span>
    <span class="n">_test_copy</span><span class="p">()</span>    
        
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Mike Hearne.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.3</a>
      
    </div>

    

    
  </body>
</html>